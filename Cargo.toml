# etp-core/Cargo.toml

[package]
name = "etp-core"
version = "1.1.0"
edition = "2025"
description = "Core implementation of the Evolutionary Transport Protocol (Full Stack)"

[lib]
# "rlib" 用于 Rust 项目引用
# "cdylib" 用于生成 C 兼容的动态库 (libetp_core.so / etp_core.dll)
crate-type = ["rlib", "cdylib"]

[features]
default = ["vpn"]
vpn = ["dep:tun"]
ffi = ["libc"]

[dependencies]
# --- 异步与运行时 ---
tokio = { version = "1.32", features = ["full"] }
futures = "0.3"
async-trait = "0.1"

# --- 数据结构与并发 ---
dashmap = "5.5"
parking_lot = "0.12"
bytes = "1.5"

# --- 序列化 ---
serde = { version = "1.0", features = ["derive"] }
bincode = "1.3"

# --- 加密与安全 ---
snow = { version = "0.9", features = ["ring-resolver"] }
chacha20poly1305 = "0.10"
ed25519-dalek = { version = "2.0", features = ["rand_core"] }
blake3 = "1.5"
rand = "0.8"
hmac = "0.12"
sha2 = "0.10" # 用于无状态 Token 的 HMAC
constant_time_eq = "0.3"

# --- 网络底层 ---
socket2 = "0.5" # 高级 Socket 选项
tun = { version = "0.6", optional = true } # VPN 支持 (可选)
igd-next = "0.14" # UPnP 支持 (比 igd 维护更好)
pnet = "0.34" # 用于获取本地网卡信息

# --- 系统与环境 ---
sysinfo = "0.29" # 检测系统资源与环境
governor = "0.6" # 速率限制 (Anti-Spam)
nonzero_ext = "0.3"

# --- 工具 ---
thiserror = "1.0"
log = "0.4"
anyhow = "1.0"
lazy_static = "1.4"
chrono = "0.4" # 时间戳处理

# 新增 libc 用于 FFI 类型定义 (仅在 ffi 特性下启用)
libc = { version = "0.2", optional = true }

[dev-dependencies]
hex = "0.4"
clap = { version = "4.0", features = ["derive"] }

